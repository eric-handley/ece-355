### Project Details

![[img/project-overview.png]]

- Potentiometer is connected to analog-digital converter
- We convert this *back* into digital, and use the NE555 and 4N35 to generate a square wave based on the resistance of the potentiometer
- We have a separate source of square wave coming from the function generator
- User button switches the source of square wave
- We output information about the current wave source (Hz) and the resistance of the potentiometer (Ohms) to SPI, which controls a display

Example wiring:

![[img/example-wiring.png]]

### Startup Configuration
- Clear screen (write all zeros)
- Setup interrupts
    - PA0, PA1, PA2, ADC, DAC
- Setup timers
    - TIM2 for frequency calculation
    - TIM3 for screen refresh rate delay

### Tasks

1. Potentiometer 
   - Poll potentiometer value (PA5). Move into ADC
   - Calculate Ohms for display
   - Move ADC output into DAC
   - Move DAC output into PA4
<br>
2. LED Screen
   - Grab Ohm/Hz values from global vars
   - Move into SPI
      - This involves converting ASCII into bitmap representation using reference table
   - Screen need only update at 10 Hz
<br>
3. Function Generation
   - Square wave is generated by NE555 circuit, sento to PA1
   - Different square wave is generated by function generator, sent to PA2
   - Interrupt (same for both sources) is used to calculate frequency
<br>
4. User Button
    - Toggles between function sources (eg. enables interrupt for one source and disables the other)
    - Triggered by PA0 interrupt

### Main Loop

- Poll potentiometer on PA5
- Move into ADC, start conversion 
- Grab Ohm/Hz values from global vars and send to LED screen
- Small delay for screen refresh rate of ~10Hz

### Interrupts

- PA0: User button
   - Toggles between interrupt source for frequency calculation
- PA1: NE555 Circuit
   - Calculates frequency based on cycles since last interrupt.
- PA2: Function Generator
   - Should activate same interrupt as PA1
- ???: ADC
   - Interrupt when AD conversion is done. 
   - Move output into global vars (for SPI) and into DAC (for NE555)
   - Start DA conversion
- ???: DAC
   - Interrupt when DA conversion is done
   - Move output into PA4 for NE555

#### Toggling Between Function Sources

To toggle between function sources, we enable EXTI for one port while disabling it for the other (PA1 vs PA2). Since PA0 and 1 have the same EXTI handler, it is important to still accept interrupts from PA0 for the user button. Whichever interrupt is enabled should then call the same function to calculate frequency based on TIM2